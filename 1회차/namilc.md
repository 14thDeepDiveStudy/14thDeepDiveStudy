# 1회차( 7월 28일 )

## 1. 비동기 프로그래밍

### 1-1. 자바스크립트는 함수를 어떻게 처리하는가?

>함수가 실행되려면 "함수 코드 평가 과정"에서 생성된 함수 실행 컨텍스트가 실행 컨텍스트 스택(콜 스택)에 푸시되어야 한다.   
>=> 실행 컨텍스트 스택에 함수 실행 컨텍스트가 푸시되는 것은 바로 함수 실행의 시작을 의미한다.   -810장 1번째 줄-

- 무슨 소린지 이해가 안되죠? 자바스크립트가 어떻게 작동하는지 대충 알고 있는 저도 이렇게 들으면 이 문장이 무엇을 의미하는지 하나도 이해가 안됩니다.

- 이 문장을 알아듣기 쉽게 바꿔 말하면, 함수가 실행되기 위해서는 콜 스택이라는 저장소에 **들어가야** 한다는 뜻입니다. 이해가 됐나요? 

<img src="https://velog.velcdn.com/images/smang66/post/90d39864-8584-43e7-982e-5a4026d6d6a7/image.png" width="500" height="400" alt="call stack">

위 사진처럼 콜 스택에 들어간 함수는 **"들어간 순서"** 대로 차곡차곡 쌓이며, LIFO(Last in First Out)방식으로 자바스크립트 엔진이 처리를 합니다.  
+ 여담이지만 **먼저 들어갔음**에도 나중에 나오는 방식이다보니, 선발대는 눈물을 머금고 자신의 차례를 기다려야합니다.

---

### 1-2. 조금 더 생각을 열어본다면...

**왜** 이렇게 처리를 할까?라는 질문이 있을 수 있습니다. 

하나씩 쌓고 하나씩 던지는 방식은 현대 시대에서는 **비효율**(혹은 레거시 혹은 올드 혹은 클래식 혹은 낡아빠진)적인 방식이기 때문입니다. 

심지어 현대 기술의 산물인 컴퓨터에서 처리를 하는 것인데도 말이죠??

### 그것은 바로....

-> 자바스크립트의 엔진(크롬 기준 **V8**, 자동차 엔진x)이 **싱글 스레드(Single Thread)** 방식으로 동작하기 때문입니다. 말 그대로 하나의 스레드만 갖고 있기 때문에 한 번에 한 개의 태스크밖에 실행하지 못해 처리에 시간이 걸리는 것이죠.
또한 동시에 2개 이상의 함수를 실행할 수도 없다는 것을 의미합니다.

> Q **.** 그럼 멀티 스레드 방식도 있겠네요??
>
> A. 좋은 질문입니다. 하지만 여기서 다룰 주제는 아니니 넘기겠습니다.

좋게 말하면 **선택과 집중**, 나쁘게 말하면 **비효율**이라고 할 수 있는 싱글 스레드 방식의 특징(~~단점~~)을 한번 알아봅시다.

---

### 블로킹(작업 중단)

예를 들어 일정 시간이 지난 후 콜백 함수를 호출하는 함수를 구현하거나 혹은 어떤 작업을 완료해야만 실행되는 함수가 있다고 치자.

나중에 호출되는 함수는 이전 함수의 실행이 끝나기 전까지 블로킹(작업 중단)되어 호출되지 못하게 된다.

```jsx
while (true) {
  console.log('코드 블로킹!')
}

console.log('이 코드는 절대 실행되지 않습니다.')
```
만약 실제로 블로킹 과정이 어떻게 이루어지는지 궁금하다면 위의 코드를 복사해 
F12 버튼을 누른 다음 ```console``` 창에 복사 붙여넣기 후 엔터를 누르면 된다. 
~~하지만 실제로 이 코드를 실행시킨다면 **끔찍한 시간을 보내게 될 것**이니 그런가보다 하고 넘어가는 것이 좋다.~~

---

## 동기(synchronous) 처리
우리가 지금까지 알아본 자바스크립트의 함수 처리법은 **동기**(team x) 처리 방식이다. 동기 방식은 앞서 열심히 설명한대로 한 번에 한 개씩 직렬적으로 처리하는 방식을 의미한다. 

왜 동기 방식으로 처리하는지 모르겠다면 처음부터 다시 읽고 오기.

### 특징
1. 순서대로 하나씩(LIFO) 처리하기 때문에 실행 순서를 보장한다.
2. 앞의 태스크가 종료되기 전까지 뒤의 태스크는 블로킹되는 단점이 있다.

>비유하자면 맛집에서 식사를 하기 위해 순번표를 받아 차례대로 줄을 선 다음, 자신의 차례가 오기까지 기다렸다가 순번표를 직원에게 보여주고 가게에 입장하는 방식. (1번이 입장하고 난 후 자리가 났을 때 2번이 입장하는)
>

![동기 처리 방식](https://velog.velcdn.com/images/smang66/post/a65b0145-6f6b-4fa6-b1cb-147308afbaa9/image.png)

출처 : https://poiemaweb.com/es6-promise

---

## 비동기(asynchronous) 처리

자바스크립트는 함수가 워낙 많이 존재한다. ```map```, ```filter```, ```slice``` 등등 셀 수 없을 정도로 존재하는데 그 중 동기 처리 방식으로 실행되는 함수도 있지만 비동기 처리 방식으로 실행되는(Web API, Ajax, ```setTimeout``` 등) 함수가 존재한다.

비동기는 동기와는 다르게 특정 코드가 끝날때 까지 **코드의 실행을 멈추지 않고** 다음 코드를 먼저 실행한다.


### 특징

1. 함수를 병렬적으로 처리하기 때문에 뒷 순서의 태스크를 블로킹 하지 않는다.
2. 비동기 요청시 응답 후 처리할 '콜백 함수'를 함께 알려주기 때문에 해당 태스크가 완료되었을 때, '콜백 함수'가 호출된다.


![비동기 처리 방식](https://velog.velcdn.com/images/smang66/post/f95272c6-d4e9-489c-9845-26058fafc03a/image.png)

출처 : https://poiemaweb.com/es6-promise


>비유하자면 예약 어플로 맛집의 대기 순서를 예약하고 자신의 차례가 오기전까지 일일이 줄을 서지 않아도 되고 다른 일을 병행해도 된다. (다른 명소를 방문한다던가...)
>

이와 연관된 Callback Hell과 ```promise```는 다음에 같이 알아보아요^^ 

---

## 자바스크립트가 비동기를 처리하는 방식

- 자바스크립트의 가장 큰 특징은 싱글 스레드로 동작한다는 것인데, 싱글 스레드로 동작하면 결국 "멀티플레이를 하지 못한다."라는 결론을 쉽게 도출할 수 있습니다.

- 그러나 브라우저의 내장되어 있는 기능 중 하나인 이벤트 루프를 통해 자바스크립트는 "멀티플레이"가 가능해집니다. 자 그럼 브라우저 환경에서 함수가 어떻게 실행되는지 그림을 통해 알아봅시다.

### 브라우저 환경 에서 . . .

![이벤트 루프와 브라우저 환경](https://velog.velcdn.com/images/smang66/post/021c9a33-03f4-4a1e-98a5-88313a560782/image.jpg)

- 왼쪽 상단에 보면 함수를 통해 실행시킬 ```console.log```들이 존재합니다. 이 글을 통해 얻은 지식으로 함수가 처리될 과정을 추측해보죠.

---

1. 자바스크립트는 싱글 스레드 방식으로 작동하기 때문에 호출된 콜백 함수들이 콜 스택에 오는 순서대로 쌓일 것이다.

2. 동기 처리 방식으로 인해 LIFO 방식으로 나중에 호출한 함수가 먼저 나가게 될 것이다.

3. ```console.log(1)```이 콜 스택에서 나가기 전까지 뒷 순서의  ```console.log```들은 블로킹을 당해 실행을 하지 못하게 된다.

4. 하지만 비동기 처리 방식으로 인해 console.log(1)이 끝나지 않았음에도 console.log(2)는 블로킹을 당하지 않고 멀쩡하게 실행이 된다.

5. console.log(1)은 앞의 두 작업이 끝나기 전까지 실행이 안될 것이다 (동기 처리 근거)

5. 그래서 결과는 console.log(3) -> console.log(2) -> console.log(1) 순서로 실행이 될 것이다.

---

아마 이렇게 추측했을 수도 있고 아닐 수도 있는데, 이렇게 추측했다는 기준 하에 하나씩 짚어봅시다.

- **1번째 레슨** : 함수를 실행하기 위해 콜 스택으로 보내기.
- **2번째 레슨** : 동기 처리 방식으로 인해 나중에 호출된 함수부터 내보내고 실행하기. (여기까지 자바스크립트 엔진을 통한 싱글 스레드 방식으로 동작)
- **3번째 레슨** : 비동기 함수는 바로 나가지 않고 WEP API로 유배 보내서 따로 실행시키기
- **4번째 레슨** : 유배기간이 끝나면 먼저 끝난 순서대로 Queue(대기열)에 입장하기.
- **5번째 레슨** : 이벤트 루프를 통해 콜 스택의 빈 자리가 있는지, WEP API에서 Queue로 이동해 대기 중인 함수가 있는지 살펴보기.
- **6번째 레슨** : 콜 스택의 빈자리 존재 && 대기열에 함수 존재 => 콜 스택으로 다시 보내기 

요렇게 해서 브라우저 환경의 함수 처리 방법을 알아보았습니다^0^
참고로 그림의 console.log 도착 순서는 (3) -> (1) -> (2초뒤 2)입니다. 제가 말한 레슨을 잘 이해하면 도착 순서가 납득갈 것입니다.

>핵심은, 자바스크립트 엔진이 기본적으로 싱글 스레드로 동작하지만, 브라우저에서는 멀티 스레드로 동작하기 때문에 블로킹 없이 물 흐르듯 자연스럽게 잘 작동하도록 흐름을 이어간다는 것 입니다.

---

## AJAX
<img src="https://velog.velcdn.com/images/smang66/post/74b2c324-6e24-47d2-a50c-5d80491d9bdf/image.png" width="300" height="300" alt="ajax soccer team">

~~네덜란드의 축구 팀 아약스~~

### AJAX(Asynchronous JavaScript and XML)란?

- 자바스크립트를 사용해 브라우저가 서버에게 비동기 방식으로 데이터를 요청하고, 서버가 응답한 데이터를 수신하여 웹 페이지를 동적으로 갱신하는 프로그래밍 방식.

